# Litera.ai â€” Comprehensive Product Requirements Document
## Multi-Phase Implementation for Replit Build

**Version:** 2.0  
**Author:** Alex (Stanford GSB)  
**Date:** January 2026  
**Build Environment:** Replit (Paid Tier)  

---

# Part I: Product Vision & Strategy

## 1. Executive Summary

Litera.ai is a "System of Action" that bridges the post-discharge communication gap between clinicians and patients. It transforms complex discharge instructions into simplified, translated, and adaptive contentâ€”delivered through persistent digital channels that satisfy regulatory requirements for Transitional Care Management (TCM) billing.

**Core Differentiators:**
1. **Regulatory-First Architecture:** Built to satisfy TCM (CPT 99495/99496) and Section 1557 compliance from day one
2. **Adaptive Health Literacy Engine:** AI that learns patient preferences and adjusts reading level, format, and communication frequency
3. **Medical Knowledge RAG:** Retrieval-augmented generation using curated medication and condition-specific knowledge bases to reduce hallucinations
4. **Human-in-the-Loop by Design:** Clinician verification workflow that shifts liability from algorithm to credentialed professional

**Business Model:** Per-seat SaaS for healthcare systems, with ROI anchored in recovered TCM billing revenue ($200-275/patient) and reduced readmission penalties.

---

## 2. Goals & Non-Goals

### Goals
| Priority | Goal | Success Metric |
|----------|------|----------------|
| P0 | Capture discharge instructions via multimodal input | Support PDF, image upload, manual entry |
| P0 | Simplify to appropriate reading level with accuracy | Flesch-Kincaid â‰¤6, <2% clinician correction rate |
| P0 | Translate with human verification | Section 1557 compliant audit trail |
| P0 | Deliver patient-accessible care plan | >70% access rate within 24 hours |
| P0 | Capture interactive contact for TCM | Documented response within 48 hours |
| P1 | Adapt content to patient preferences | Measurable engagement improvement |
| P1 | Provide chatbot for logistics questions | Deflect 50% of non-clinical inquiries |
| P2 | Integrate with EHR systems | SMART on FHIR readiness |

### Non-Goals (Current Scope)
| Item | Why Not | Future Phase |
|------|---------|--------------|
| Clinical chatbot for medical advice | Liability risk; requires extensive guardrails | Phase 4+ |
| Real-time telehealth | Redundant with existing tools | Never |
| Native iOS/Android apps | PWA covers 90% of use cases | Phase 3 (optional) |
| Pharmacy integration | Complex legal/API requirements | Phase 5+ |
| Predictive readmission models | Requires large dataset; distraction | Phase 5+ |

---

## 3. Personas

### Primary Personas

**Maria Chen â€” Discharge Nurse (Clinician User)**
- **Context:** Community hospital, discharges 8-12 patients per shift
- **Pain Points:** 
  - EHR summaries are clinician-facing, not patient-friendly
  - No time for manual translation or simplification
  - Struggles to document TCM compliance
- **Jobs to Be Done:**
  - Upload/capture discharge summary in <30 seconds
  - Review AI output in <90 seconds
  - Send to patient with single click
- **Success:** Can complete Litera workflow while patient is still in room

**Rosa Hernandez â€” LEP Patient (Patient User)**
- **Context:** 68, Spanish-speaking, discharged after pneumonia, lives with adult daughter
- **Pain Points:**
  - Cannot read English discharge papers
  - Doesn't know which pills to take when
  - Afraid of going back to hospital
- **Jobs to Be Done:**
  - Access instructions on her phone without downloading app
  - Understand what to do each day
  - Get help if something feels wrong
- **Success:** Completes medication regimen correctly; knows when to call

### Secondary Personas

**Dr. James Park â€” Hospitalist (Sponsor)**
- Wants to reduce readmissions and capture TCM revenue
- Needs audit-ready documentation
- Decision-maker for pilot expansion

**Angela Torres â€” Care Manager**
- Monitors patient follow-up across panel
- Needs alerts for at-risk patients
- Uses Litera as command center

**David Kim â€” Hospital CFO (Buyer)**
- Evaluates ROI: TCM capture + readmission reduction
- Needs clear metrics dashboard
- Concerned about compliance risk

---

## 4. User Stories

### Epic 1: Multimodal Ingestion
| ID | Story | Priority | Phase |
|----|-------|----------|-------|
| US-1.1 | As a nurse, I can upload a PDF discharge summary for extraction | P0 | 1 |
| US-1.2 | As a nurse, I can upload a photo of paper instructions | P0 | 1 |
| US-1.3 | As a nurse, I can manually enter/edit extracted content | P0 | 1 |
| US-1.4 | As a nurse, I can use speech-to-text to dictate instructions | P1 | 2 |
| US-1.5 | As a nurse, I can pull data directly from Epic/Cerner | P2 | 4 |

### Epic 2: AI Processing (Simplification, Translation, RAG)
| ID | Story | Priority | Phase |
|----|-------|----------|-------|
| US-2.1 | As a nurse, I can select patient's preferred language | P0 | 1 |
| US-2.2 | As a nurse, I can see original vs. simplified side-by-side | P0 | 1 |
| US-2.3 | As a nurse, I can hover over translation to see back-translation | P0 | 1 |
| US-2.4 | As a nurse, I can edit any content before approval | P0 | 1 |
| US-2.5 | As a system, I augment simplification with RAG knowledge base | P1 | 2 |
| US-2.6 | As a system, I detect medication interactions and surface warnings | P1 | 2 |
| US-2.7 | As a system, I adapt reading level based on patient profile | P1 | 2 |

### Epic 3: Human-in-the-Loop Compliance
| ID | Story | Priority | Phase |
|----|-------|----------|-------|
| US-3.1 | As a nurse, I must verify content before patient delivery | P0 | 1 |
| US-3.2 | As an admin, I can see who approved each plan and when | P0 | 1 |
| US-3.3 | As a system, I calculate edit distance between AI output and final | P1 | 2 |

### Epic 4: Patient Experience
| ID | Story | Priority | Phase |
|----|-------|----------|-------|
| US-4.1 | As a patient, I receive notification with magic link | P0 | 1 |
| US-4.2 | As a patient, I verify identity with DOB before access | P0 | 1 |
| US-4.3 | As a patient, I view instructions on mobile-responsive page | P0 | 1 |
| US-4.4 | As a patient, I can toggle between languages | P0 | 1 |
| US-4.5 | As a patient, I can tap "Read Aloud" for TTS | P1 | 2 |
| US-4.6 | As a patient, I can ask logistics questions to chatbot | P1 | 3 |
| US-4.7 | As a patient, I can install PWA to home screen | P1 | 2 |

### Epic 5: Interactive Contact (TCM)
| ID | Story | Priority | Phase |
|----|-------|----------|-------|
| US-5.1 | As a patient, I receive check-in within 48 hours | P0 | 1 |
| US-5.2 | As a patient, I respond with traffic light (Green/Yellow/Red) | P0 | 1 |
| US-5.3 | As a nurse, I get alert for Yellow/Red responses | P0 | 1 |
| US-5.4 | As a system, I retry if no response within 4 hours | P0 | 1 |
| US-5.5 | As a system, I send scheduled "drip" messages on Days 1,3,7 | P1 | 2 |

### Epic 6: Admin & Analytics
| ID | Story | Priority | Phase |
|----|-------|----------|-------|
| US-6.1 | As an admin, I see all patients with status indicators | P0 | 1 |
| US-6.2 | As an admin, I export CSV with TCM-ready data | P0 | 1 |
| US-6.3 | As an admin, I see suggested billing codes | P1 | 2 |
| US-6.4 | As an admin, I see engagement analytics dashboard | P2 | 3 |
| US-6.5 | As an admin, I see revenue capture metrics | P2 | 3 |

### Epic 7: EHR Integration (Interface-Ready)
| ID | Story | Priority | Phase |
|----|-------|----------|-------|
| US-7.1 | As an admin, I can configure EHR connection settings | Interface | 1 |
| US-7.2 | As a nurse, I can select patient from EHR patient list | Interface | 1 |
| US-7.3 | As a system, I query FHIR API for patient data | Functional | 4 |

---

## 5. Functional Requirements

### 5.1 Ingestion Engine

**FR-1.1: PDF Upload**
- Accept .pdf files up to 10MB
- Extract text using PyMuPDF; detect scanned vs. text-based
- Fall back to GPT-4o Vision for scanned documents

**FR-1.2: Image Upload**
- Accept .jpg, .png, .heic up to 10MB
- Process via GPT-4o Vision API
- Handle photos of printed discharge papers

**FR-1.3: Manual Entry**
- Structured form with sections: Diagnosis, Medications, Appointments, Instructions
- Medication rows: Name, Dose, Frequency, Special Instructions
- Appointment rows: Date, Time, Provider, Location, Purpose

**FR-1.4: Speech-to-Text (Phase 2)**
- Browser-based Web Speech API or Whisper API
- Clinician dictates; system transcribes and structures
- Review before processing

### 5.2 AI Processing Pipeline

**FR-2.1: Extraction**
- Output structured JSON matching schema (diagnosis, medications[], appointments[], restrictions[], warnings[])
- Confidence scores per field
- Flag low-confidence extractions for human review

**FR-2.2: Simplification**
- Target: Flesch-Kincaid â‰¤6 (configurable per patient)
- Preserve drug names exactly
- Break complex instructions into numbered steps
- Validate output with textstat library

**FR-2.3: Translation**
- Support all languages GPT-4o handles
- Primary dropdown: Spanish, Chinese (Simplified), Vietnamese, Tagalog, Korean, Russian, Arabic, French, Portuguese, Hindi, Urdu, Farsi, Polish, Haitian Creole, Japanese
- "Other" option with free-text input
- Generate back-translation for verification

**FR-2.4: RAG Enhancement (Phase 2)**
- Vector database with medication guides and condition-specific instructions
- Retrieve relevant context before generation
- Surface safety warnings for high-risk medications
- See Technical Differentiation section for details

### 5.3 Compliance Gate (HITL)

**FR-3.1: Review Interface**
- Three-column layout: Original | Simplified | Translated
- All columns editable
- Hover on translated text shows back-translation tooltip
- Character-level diff highlighting for changes

**FR-3.2: Approval Flow**
- "Verify & Approve" button requires explicit action
- Cannot send to patient until approved
- Logs: reviewer_id, timestamp, edit_distance

### 5.4 Patient Delivery

**FR-4.1: Notification Channels**
- Phase 1: Email (via Resend)
- Phase 2: SMS (via Twilio)
- Phase 3: WhatsApp (via Twilio)
- Channel preference stored per patient

**FR-4.2: Magic Link Access**
- Unique token per care plan (64-char)
- Token expires after 30 days
- Patient verifies with year of birth
- 3 failed attempts = temporary lockout

**FR-4.3: Patient View**
- Mobile-first responsive design
- Large touch targets (44x44px minimum)
- High contrast, 18px base font
- Traffic light symptom tracker (Green/Yellow/Red)
- Medication cards with timing icons
- Appointment cards with map links

**FR-4.4: Text-to-Speech (Phase 2)**
- OpenAI TTS API or browser speechSynthesis
- "Read Aloud" button on each section
- Language-aware voice selection

### 5.5 Interactive Contact

**FR-5.1: Scheduled Check-In**
- First check-in: T+24 hours from discharge
- Time zone aware (patient's local time)
- Avoid delivery between 9pm-8am local

**FR-5.2: Response Handling**
- Green: Log success, update status
- Yellow: Alert clinician, suggest callback
- Red: Alert clinician immediately, provide 911 guidance
- No response: Retry at T+4 hours, then T+8 hours

**FR-5.3: Drip Schedule (Phase 2)**
- Day 0: Welcome + medication list
- Day 1: Check-in (interactive contact)
- Day 3: Appointment reminder
- Day 7: Progress check
- Configurable per complexity level

### 5.6 Admin Dashboard

**FR-6.1: Patient List**
- Columns: Name, Discharge Date, Status, Language, Last Contact
- Status indicators: Draft, Pending Review, Approved, Sent, Responded, Alert, Completed
- Filter by status, date range, clinician

**FR-6.2: Export**
- CSV with TCM-relevant fields
- PDF audit report per patient
- Batch export for billing period

**FR-6.3: Analytics (Phase 3)**
- Access rate by time
- Response rate by channel
- Average time to response
- Engagement by language

### 5.7 Interface-Only Features (Phase 1 Shells)

These features appear in the UI navigation and display placeholder content, demonstrating where functionality will live without backend implementation.

**IF-7.1: EHR Integration Settings**
- Settings page with EHR selector (Epic, Cerner, Meditech)
- "Coming Soon" badge
- Fields for client ID, endpoint URL (disabled)
- "Request Integration" button â†’ email capture

**IF-7.2: Analytics Dashboard**
- Dashboard with chart placeholders
- Sample data visualization
- "Live data coming soon" overlay

**IF-7.3: Chatbot Preview**
- Chat interface in patient view
- Limited to 3 pre-canned responses
- "Full chatbot coming soon" message

**IF-7.4: Wearables/Remote Monitoring**
- Settings section for device connections
- List of supported devices (Apple Watch, Fitbit, etc.)
- "Coming in Phase 4" label

---

## 6. Technical Differentiation

### 6.1 Adaptive Health Literacy Engine

**Problem:** Static 5th-grade simplification doesn't work for everyone. Some patients find it patronizing; others still struggle.

**Solution:** Learn patient preferences and adapt.

**Implementation:**
```
Patient Profile:
- preferred_reading_level: 3-12 (default: 5)
- prefers_audio: boolean
- prefers_visual_aids: boolean
- engagement_score: 0-100
- languages: [primary, secondary]

Behavioral Signals (tracked per session):
- time_on_page
- scroll_depth
- zoom_level_changes
- "read_aloud" button usage
- language_toggle_frequency
- return_visits

Adaptation Rules:
- If zoom_level_changes > 3 AND time_on_page > 5min â†’ suggest larger text, offer audio
- If return_visits > 2 for same content â†’ simplify further OR surface chatbot
- If engagement_score < 30 â†’ alert clinician for follow-up call
```

**Phase 2 Deliverable:** Patient profile system with behavioral tracking. Phase 3: Adaptive content generation.

### 6.2 Medical Knowledge RAG

**Problem:** Generic LLMs can hallucinate medication instructions or miss critical warnings.

**Solution:** Retrieval-Augmented Generation with curated medical knowledge.

**Knowledge Base Components:**
1. **FDA Medication Guides** - Official patient-facing drug information
2. **Condition-Specific Recovery** - Heart failure zones, post-surgical care
3. **Hospital Protocols** - Custom uploads per client
4. **Interaction Warnings** - Common drug-drug and drug-food interactions

**Implementation:**
```python
# RAG Pipeline
def generate_simplified_instructions(extracted_data, patient_profile):
    # 1. Retrieve relevant knowledge
    medications = extracted_data['medications']
    knowledge_chunks = []
    
    for med in medications:
        chunks = vector_db.query(
            query=f"{med['name']} patient instructions warnings",
            top_k=3,
            filter={"type": "medication_guide"}
        )
        knowledge_chunks.extend(chunks)
    
    # 2. Check for interactions
    if len(medications) > 1:
        interaction_check = vector_db.query(
            query=f"interactions {' '.join([m['name'] for m in medications])}",
            top_k=2,
            filter={"type": "interaction_warning"}
        )
        knowledge_chunks.extend(interaction_check)
    
    # 3. Generate with augmented context
    prompt = f"""
    Simplify these discharge instructions to grade level {patient_profile.reading_level}.
    
    EXTRACTED DATA:
    {json.dumps(extracted_data)}
    
    RELEVANT MEDICAL KNOWLEDGE:
    {format_chunks(knowledge_chunks)}
    
    RULES:
    - Include any warnings from the knowledge base
    - Preserve drug names exactly
    - Flag any interactions found
    """
    
    return llm.generate(prompt)
```

**Vector Database:** Pinecone (free tier: 100K vectors) or Chroma (local, open source)

**Phase 2 Deliverable:** MVP knowledge base with 100 common medications + 10 conditions

### 6.3 OpenEvidence Integration Path (Phase 4+)

OpenEvidence API is typically priced per medical analysis for a given topic or question. A medical analysis is an answer with a detailed clinical research overview and includes citations, sources, and references.

**Use Cases for Litera:**
- Clinician-facing: Evidence support for complex discharge decisions
- Chatbot backend: Cited answers for patient medication questions
- Quality assurance: Validate AI-generated instructions against evidence

**Integration Architecture:**
```
Patient Question â†’ Intent Classification
    â†“
Logistics Question â†’ Internal FAQ (Phase 3)
Medical Question â†’ Guardrails Check
    â†“
Safe Question â†’ OpenEvidence API â†’ Cited Answer
Unsafe Question â†’ "Please contact your care team"
```

**Cost Consideration:** OpenEvidence pricing is per-query. Budget ~$0.50-1.00 per medical analysis. For MVP, focus on RAG; add OpenEvidence for premium tier.

### 6.4 Readability Validation Pipeline

After optimization by the LLMs, readability scores significantly improved across all 3 websites when compared with the original text. Compared with the original website, Wilcoxon signed rank test showed ChatGPT improved the readability to 7.6 from 10.1 (P<.001); Gemini, to 6.6 (P<.001); and Claude, to 5.6 (P<.001).

**Implementation:**
```python
import textstat

def validate_and_refine(text, target_grade=5, max_attempts=3):
    for attempt in range(max_attempts):
        grade = textstat.flesch_kincaid_grade(text)
        
        if grade <= target_grade + 1:
            return {
                "text": text,
                "grade_level": grade,
                "attempts": attempt + 1,
                "passed": True
            }
        
        # Retry with stricter prompt
        text = simplify_further(text, target_grade)
    
    return {
        "text": text,
        "grade_level": grade,
        "attempts": max_attempts,
        "passed": False,
        "requires_review": True
    }
```

---

## 7. Feature Scope Matrix

| Feature | Phase 1 (2 weeks) | Phase 2 (+2 weeks) | Phase 3 (+4 weeks) | Phase 4+ |
|---------|-------------------|--------------------|--------------------|----------|
| **Ingestion** |
| PDF Upload | âœ… Functional | | | |
| Image Upload | âœ… Functional | | | |
| Manual Entry | âœ… Functional | | | |
| Speech-to-Text | ðŸ”² Interface | âœ… Functional | | |
| EHR Pull | ðŸ”² Interface | ðŸ”² Interface | ðŸ”² Interface | âœ… Functional |
| **AI Processing** |
| Simplification | âœ… Functional | | | |
| Translation | âœ… Functional | | | |
| Back-translation | âœ… Functional | | | |
| RAG Enhancement | | âœ… Functional | | |
| Adaptive Level | | âœ… Functional | | |
| **Compliance** |
| HITL Review | âœ… Functional | | | |
| Audit Logging | âœ… Functional | | | |
| Edit Tracking | | âœ… Functional | | |
| **Patient UX** |
| Magic Link | âœ… Functional | | | |
| Responsive View | âœ… Functional | | | |
| Language Toggle | âœ… Functional | | | |
| Traffic Light | âœ… Functional | | | |
| TTS Read Aloud | ðŸ”² Interface | âœ… Functional | | |
| PWA Install | | âœ… Functional | | |
| Chatbot | ðŸ”² Interface | ðŸ”² Interface | âœ… Functional | |
| **Notifications** |
| Email | âœ… Functional | | | |
| SMS | ðŸ”² Interface | âœ… Functional | | |
| WhatsApp | | ðŸ”² Interface | âœ… Functional | |
| **Admin** |
| Patient List | âœ… Functional | | | |
| CSV Export | âœ… Functional | | | |
| Alerts | âœ… Functional | | | |
| Analytics | ðŸ”² Interface | ðŸ”² Interface | âœ… Functional | |
| Revenue Dashboard | ðŸ”² Interface | | âœ… Functional | |
| **Integrations** |
| EHR Settings | ðŸ”² Interface | ðŸ”² Interface | ðŸ”² Interface | âœ… Functional |
| Wearables | | ðŸ”² Interface | ðŸ”² Interface | TBD |

**Legend:**
- âœ… Functional: Working feature with backend logic
- ðŸ”² Interface: UI present, placeholder/limited functionality

---

# Part II: Phase Implementation Roadmap

## Phase 1: Core MVP (2 Weeks)

### Objectives
1. End-to-end functional flow: Upload â†’ Simplify â†’ Translate â†’ Review â†’ Send â†’ Respond
2. Regulatory compliance: HITL gate, audit logging
3. Demo-ready: Realistic UI for judging + initial pilot testing

### Week 1: Foundation
| Day | Deliverables |
|-----|--------------|
| 1-2 | Project setup, database schema, React scaffolding |
| 3-4 | PDF/Image upload + GPT-4o extraction |
| 5-6 | Simplification + translation pipeline |
| 7 | Basic 3-column review interface |

### Week 2: Integration + Polish
| Day | Deliverables |
|-----|--------------|
| 8-9 | Patient view (magic link, DOB verify, responsive) |
| 10-11 | Email delivery (Resend), check-in flow |
| 12-13 | Admin dashboard, CSV export, alerts |
| 14 | Interface shells, demo prep, synthetic test data |

### Milestone Checklist
- [ ] Nurse can upload PDF and see structured extraction in <30 seconds
- [ ] Simplified + translated content displays side-by-side
- [ ] Nurse can edit and approve; audit log captures action
- [ ] Patient receives email with magic link
- [ ] Patient can access, view, toggle language
- [ ] Patient can respond to traffic light check-in
- [ ] Admin can see all patients and export CSV
- [ ] Interface shells exist for: Speech input, SMS, EHR, Analytics

---

## Phase 2: Enhanced Intelligence (Weeks 3-4)

### Objectives
1. RAG-enhanced simplification with medication knowledge base
2. Adaptive patient profiles
3. SMS delivery channel
4. Text-to-speech accessibility

### Technical Additions
```
New Dependencies:
- pinecone-client OR chromadb (vector store)
- twilio (SMS)
- openai (TTS API - optional, can use browser)

New Database Tables:
- knowledge_chunks (id, content, embedding, type, source)
- patient_profiles (patient_id, reading_level, preferences, signals)
- behavioral_events (patient_id, event_type, metadata, timestamp)
```

### Deliverables
- [ ] Vector DB with 100 medication guides ingested
- [ ] RAG pipeline integrated into simplification
- [ ] Patient profile tracking (basic signals)
- [ ] Twilio SMS integration
- [ ] OpenAI TTS or browser TTS working
- [ ] Drip scheduler (Day 0, 1, 3, 7 messages)
- [ ] PWA manifest + service worker

### Migration Steps
1. Add Pinecone/Chroma to requirements
2. Create embedding pipeline for knowledge base
3. Extend simplification service to use RAG
4. Add Twilio credentials to secrets
5. Implement SMS delivery service
6. Add TTS button to patient view
7. Configure PWA meta tags and service worker

---

## Phase 3: Patient Engagement (Weeks 5-8)

### Objectives
1. Logistics chatbot for non-clinical questions
2. WhatsApp delivery channel
3. Analytics dashboard with real metrics
4. Revenue tracking

### Chatbot Architecture
```
Intent Categories:
1. APPOINTMENT - "When is my follow-up?"
   â†’ Query appointments table â†’ Format response
   
2. MEDICATION - "What time should I take my pills?"
   â†’ Query medications table â†’ Format schedule
   
3. LOCATION - "Where do I park?"
   â†’ Hospital-specific FAQ (RAG)
   
4. SYMPTOM - "My leg hurts"
   â†’ "Please contact your care team at [phone]"
   â†’ Log for clinician review
   
5. OTHER - Fallback
   â†’ "I can help with appointments, medications, and directions. 
      For medical questions, please call [phone]."
```

### Deliverables
- [ ] Chatbot UI in patient view
- [ ] Intent classification (GPT-4o or fine-tuned classifier)
- [ ] FAQ knowledge base per hospital
- [ ] Escalation flow for medical questions
- [ ] WhatsApp Business API integration
- [ ] Template approval for WhatsApp
- [ ] Analytics dashboard (access rates, response times, channels)
- [ ] Revenue capture visualization

---

## Phase 4: Enterprise Readiness (Months 2-3)

### Objectives
1. SMART on FHIR integration for EHR connectivity
2. SSO/SAML for enterprise authentication
3. Role-based access control
4. Multi-tenant architecture

### EHR Integration Path
```
Integration Options (by complexity):
1. Manual PDF Export (Phase 1) - No IT involvement
2. Clipboard/Screen Capture (Phase 2) - No IT involvement
3. SMART on FHIR App (Phase 4) - IT approval required

SMART on FHIR Implementation:
- Register as SMART App with Epic/Cerner
- OAuth2 authorization flow
- Query: GET /Patient/{id}/MedicationRequest
- Query: GET /Patient/{id}/Appointment
- Replace PDF extraction with FHIR data mapping
```

### Deliverables
- [ ] FHIR client library integrated
- [ ] OAuth2 flow for Epic sandbox
- [ ] Data mapping from FHIR resources to Litera schema
- [ ] SSO integration (Auth0 or similar)
- [ ] Multi-tenant database isolation
- [ ] Admin console for tenant management

---

## Phase 5: Advanced AI (Months 3-6)

### Objectives
1. OpenEvidence integration for evidence-backed answers
2. Predictive engagement scoring
3. Custom model fine-tuning
4. Multi-language voice (regional accents)

### OpenEvidence Integration
```python
# For premium tier / clinician-facing features
async def get_evidence_backed_answer(question: str, context: str):
    response = await openevidence_client.analyze(
        question=question,
        context=context,
        include_citations=True
    )
    return {
        "answer": response.summary,
        "citations": response.references,
        "confidence": response.confidence
    }
```

---

# Part III: Technical Architecture

## 1. System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           LITERA.AI ARCHITECTURE                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        FRONTEND (React)                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ Clinicianâ”‚  â”‚ Patient  â”‚  â”‚  Admin   â”‚  â”‚  Interface-Only  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   App    â”‚  â”‚   PWA    â”‚  â”‚Dashboard â”‚  â”‚  (EHR, Analytics)â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                    â”‚                                    â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚                          â”‚   Flask API       â”‚                         â”‚
â”‚                          â”‚   (REST + SSE)    â”‚                         â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                    â”‚                                    â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚     â”‚                              â”‚                              â”‚    â”‚
â”‚ â”Œâ”€â”€â”€â–¼â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚ â”‚ Pgsql â”‚  â”‚ Redis     â”‚  â”‚ AI Services   â”‚  â”‚ External APIs  â”‚  â”‚    â”‚
â”‚ â”‚       â”‚  â”‚ (Queue)   â”‚  â”‚               â”‚  â”‚                â”‚  â”‚    â”‚
â”‚ â”‚ - DB  â”‚  â”‚ - Jobs    â”‚  â”‚ - OpenAI      â”‚  â”‚ - Resend       â”‚  â”‚    â”‚
â”‚ â”‚ - Auditâ”‚  â”‚ - Cache   â”‚  â”‚ - Pinecone    â”‚  â”‚ - Twilio       â”‚  â”‚    â”‚
â”‚ â”‚       â”‚  â”‚           â”‚  â”‚ - (OpenEvid)  â”‚  â”‚ - (FHIR)       â”‚  â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚                                                                   â”‚    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2. Technology Stack

### Frontend
| Component | Choice | Rationale |
|-----------|--------|-----------|
| Framework | **React 18** | Component-based; enables PWA and future mobile |
| Styling | **Tailwind CSS** | Utility-first; rapid prototyping |
| State | **React Query + Zustand** | Server state + local state separation |
| Routing | **React Router 6** | Standard; supports nested routes |
| Build | **Vite** | Fast HMR; Replit-friendly |

### Backend
| Component | Choice | Rationale |
|-----------|--------|-----------|
| Framework | **Flask** | Simple, Python-native, fast iteration |
| ORM | **SQLAlchemy 2.0** | Type hints; async support |
| Validation | **Pydantic** | Request/response validation |
| Task Queue | **Redis + RQ** | Background jobs for AI processing |
| PDF Parsing | **PyMuPDF** | Fast, handles most PDFs |
| OCR | **GPT-4o Vision** | Better than Tesseract for messy docs |

### Data Layer
| Component | Choice | Rationale |
|-----------|--------|-----------|
| Primary DB | **PostgreSQL** | Replit native; JSONB support |
| Vector DB | **Pinecone (Phase 2)** | Free tier; managed service |
| Cache | **Redis** | Session cache; rate limiting |

### External Services
| Service | Purpose | Phase |
|---------|---------|-------|
| **OpenAI** | GPT-4o extraction, simplification, translation, TTS | 1 |
| **Resend** | Email delivery | 1 |
| **Twilio** | SMS, WhatsApp | 2-3 |
| **Pinecone** | Vector storage for RAG | 2 |
| **OpenEvidence** | Medical evidence API | 4+ |

## 3. Database Schema

```sql
-- Core Tables
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR(255) UNIQUE NOT NULL,
    name VARCHAR(255) NOT NULL,
    role VARCHAR(50) DEFAULT 'clinician', -- clinician, admin, super_admin
    organization_id UUID,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE patients (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    mrn_hash VARCHAR(64), -- Hashed for privacy
    first_name VARCHAR(255),
    phone VARCHAR(20),
    email VARCHAR(255),
    dob_year INTEGER NOT NULL, -- For verification only
    preferred_language VARCHAR(10) DEFAULT 'en',
    preferred_channel VARCHAR(20) DEFAULT 'email', -- email, sms, whatsapp
    created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE patient_profiles (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    patient_id UUID REFERENCES patients(id) UNIQUE,
    reading_level INTEGER DEFAULT 5, -- Flesch-Kincaid target
    prefers_audio BOOLEAN DEFAULT FALSE,
    prefers_visual_aids BOOLEAN DEFAULT TRUE,
    engagement_score INTEGER DEFAULT 50, -- 0-100
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE care_plans (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    patient_id UUID REFERENCES patients(id) NOT NULL,
    created_by UUID REFERENCES users(id) NOT NULL,
    
    status VARCHAR(50) DEFAULT 'draft',
    -- draft â†’ processing â†’ pending_review â†’ approved â†’ sent â†’ completed
    
    discharge_date TIMESTAMPTZ,
    complexity VARCHAR(20), -- moderate, high (for TCM)
    
    -- HITL tracking
    approved_by UUID REFERENCES users(id),
    approved_at TIMESTAMPTZ,
    
    -- Patient access
    access_token VARCHAR(64) UNIQUE,
    token_expires_at TIMESTAMPTZ,
    
    -- Source
    source_type VARCHAR(20), -- pdf, image, manual, fhir
    source_url TEXT,
    
    -- AI processing metadata
    extraction_confidence FLOAT,
    simplification_grade FLOAT,
    
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE care_plan_content (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    care_plan_id UUID REFERENCES care_plans(id) NOT NULL,
    
    section VARCHAR(50) NOT NULL, -- diagnosis, medications, appointments, instructions, warnings
    
    original_text TEXT,
    simplified_text TEXT,
    translated_text TEXT,
    back_translation TEXT,
    
    structured_data JSONB, -- For medications: [{name, dose, frequency, instructions}]
    
    -- RAG enhancement
    rag_chunks_used JSONB, -- IDs of knowledge chunks used
    warnings_surfaced JSONB, -- Any safety warnings from RAG
    
    display_order INTEGER DEFAULT 0,
    
    created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE check_ins (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    care_plan_id UUID REFERENCES care_plans(id) NOT NULL,
    
    scheduled_for TIMESTAMPTZ NOT NULL,
    sent_at TIMESTAMPTZ,
    delivery_channel VARCHAR(20), -- email, sms, whatsapp, in_app
    delivery_status VARCHAR(20), -- pending, sent, delivered, failed
    
    response VARCHAR(20), -- green, yellow, red, null
    responded_at TIMESTAMPTZ,
    response_notes TEXT,
    
    attempt_number INTEGER DEFAULT 1,
    
    created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE behavioral_events (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    patient_id UUID REFERENCES patients(id) NOT NULL,
    care_plan_id UUID REFERENCES care_plans(id),
    
    event_type VARCHAR(50) NOT NULL,
    -- page_view, scroll, zoom, tts_click, language_toggle, checkin_response
    
    metadata JSONB,
    -- {scroll_depth: 0.8, time_on_page: 45, zoom_level: 1.5}
    
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Audit Log (immutable)
CREATE TABLE audit_log (
    id BIGSERIAL PRIMARY KEY,
    entity_type VARCHAR(50) NOT NULL,
    entity_id UUID NOT NULL,
    action VARCHAR(50) NOT NULL,
    -- created, updated, approved, sent, viewed, responded, exported
    
    actor_id UUID REFERENCES users(id),
    actor_type VARCHAR(20), -- user, system, patient
    
    old_value JSONB,
    new_value JSONB,
    metadata JSONB, -- IP, user agent, etc.
    
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Knowledge Base (Phase 2)
CREATE TABLE knowledge_chunks (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    content TEXT NOT NULL,
    embedding VECTOR(1536), -- OpenAI embedding dimension
    
    chunk_type VARCHAR(50), -- medication_guide, condition_info, interaction, hospital_protocol
    source VARCHAR(255),
    source_url TEXT,
    
    metadata JSONB,
    -- {drug_name: "Metoprolol", category: "beta_blocker"}
    
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_care_plans_patient ON care_plans(patient_id);
CREATE INDEX idx_care_plans_status ON care_plans(status);
CREATE INDEX idx_care_plans_token ON care_plans(access_token);
CREATE INDEX idx_check_ins_scheduled ON check_ins(scheduled_for) WHERE sent_at IS NULL;
CREATE INDEX idx_audit_log_entity ON audit_log(entity_type, entity_id);
CREATE INDEX idx_behavioral_events_patient ON behavioral_events(patient_id, created_at);
```

## 4. API Endpoints

### Authentication
| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/auth/login` | Email/password login |
| POST | `/api/auth/logout` | Invalidate session |
| GET | `/api/auth/me` | Current user info |

### Care Plans
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/care-plans` | List care plans (paginated) |
| POST | `/api/care-plans` | Create new care plan |
| GET | `/api/care-plans/:id` | Get care plan details |
| PATCH | `/api/care-plans/:id` | Update care plan |
| POST | `/api/care-plans/:id/process` | Trigger AI processing |
| POST | `/api/care-plans/:id/approve` | Approve for delivery |
| POST | `/api/care-plans/:id/send` | Send to patient |

### Ingestion
| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/ingest/pdf` | Upload PDF |
| POST | `/api/ingest/image` | Upload image |
| POST | `/api/ingest/manual` | Manual entry |
| POST | `/api/ingest/speech` | Speech-to-text (Phase 2) |

### AI Services
| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/ai/extract` | Extract from document |
| POST | `/api/ai/simplify` | Simplify text |
| POST | `/api/ai/translate` | Translate text |
| POST | `/api/ai/tts` | Generate audio (Phase 2) |

### Patient Access
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/p/:token` | Patient landing page |
| POST | `/p/:token/verify` | Verify DOB |
| GET | `/p/:token/view` | Patient view (after verify) |
| POST | `/p/:token/checkin` | Submit check-in response |
| POST | `/p/:token/event` | Track behavioral event |
| POST | `/p/:token/chat` | Chatbot message (Phase 3) |

### Admin
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/admin/patients` | All patients with status |
| GET | `/api/admin/alerts` | Patients needing attention |
| GET | `/api/admin/export` | CSV export |
| GET | `/api/admin/analytics` | Dashboard data (Phase 3) |

---

## 5. Project Structure

```
litera-ai/
â”œâ”€â”€ client/                      # React frontend
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ clinician/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Dashboard.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UploadForm.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ReviewEditor.tsx    # 3-column HITL
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ PatientList.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ patient/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Landing.tsx         # DOB verification
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CarePlanView.tsx    # Main patient view
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ TrafficLight.tsx    # Check-in UI
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MedicationCard.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ChatWidget.tsx      # Phase 3
â”‚   â”‚   â”‚   â”œâ”€â”€ admin/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AdminDashboard.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AnalyticsCharts.tsx # Phase 3 (interface)
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ExportButton.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ shared/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LoadingSpinner.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LanguageSelector.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ InterfaceShell.tsx  # For "coming soon" features
â”‚   â”‚   â”‚   â””â”€â”€ ui/                     # shadcn/ui components
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â”œâ”€â”€ useCarePlans.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ usePatientView.ts
â”‚   â”‚   â”‚   â””â”€â”€ useBehavioralTracking.ts
â”‚   â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts                  # API client
â”‚   â”‚   â”‚   â””â”€â”€ utils.ts
â”‚   â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â”‚   â””â”€â”€ appStore.ts             # Zustand store
â”‚   â”‚   â”œâ”€â”€ App.tsx
â”‚   â”‚   â””â”€â”€ main.tsx
â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â”œâ”€â”€ manifest.json               # PWA manifest
â”‚   â”‚   â””â”€â”€ sw.js                       # Service worker (Phase 2)
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ vite.config.ts
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ server/                      # Flask backend
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ __init__.py         # Flask app factory
â”‚   â”‚   â”œâ”€â”€ models.py           # SQLAlchemy models
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py
â”‚   â”‚   â”‚   â”œâ”€â”€ care_plans.py
â”‚   â”‚   â”‚   â”œâ”€â”€ ingestion.py
â”‚   â”‚   â”‚   â”œâ”€â”€ ai_services.py
â”‚   â”‚   â”‚   â”œâ”€â”€ patient.py
â”‚   â”‚   â”‚   â””â”€â”€ admin.py
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ extraction.py   # PDF/Image processing
â”‚   â”‚   â”‚   â”œâ”€â”€ simplification.py
â”‚   â”‚   â”‚   â”œâ”€â”€ translation.py
â”‚   â”‚   â”‚   â”œâ”€â”€ rag.py          # Phase 2
â”‚   â”‚   â”‚   â”œâ”€â”€ delivery.py     # Email, SMS, WhatsApp
â”‚   â”‚   â”‚   â”œâ”€â”€ scheduler.py    # Check-in scheduling
â”‚   â”‚   â”‚   â””â”€â”€ chatbot.py      # Phase 3
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”‚   â”œâ”€â”€ readability.py  # Flesch-Kincaid validation
â”‚   â”‚   â”‚   â””â”€â”€ audit.py        # Audit logging helper
â”‚   â”‚   â””â”€â”€ config.py
â”‚   â”œâ”€â”€ migrations/             # Alembic migrations
â”‚   â”œâ”€â”€ tests/
â”‚   â””â”€â”€ requirements.txt
â”‚
â”œâ”€â”€ knowledge_base/             # RAG content (Phase 2)
â”‚   â”œâ”€â”€ medications/
â”‚   â”‚   â””â”€â”€ *.txt               # FDA medication guides
â”‚   â”œâ”€â”€ conditions/
â”‚   â”‚   â””â”€â”€ *.txt               # Condition recovery info
â”‚   â””â”€â”€ ingest.py               # Embedding script
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ seed_demo_data.py
â”‚   â””â”€â”€ generate_synthetic.py
â”‚
â”œâ”€â”€ .env.example
â”œâ”€â”€ replit.nix
â””â”€â”€ README.md
```

---

## 6. Setup Checklist

### Phase 1 Setup

#### External Accounts
- [ ] **OpenAI:** Create account â†’ API Keys â†’ Generate key â†’ Add as `OPENAI_API_KEY`
- [ ] **Resend:** Sign up â†’ Get API key â†’ Add as `RESEND_API_KEY`
- [ ] **Resend:** Verify sending domain (or use resend.dev for testing)

#### Replit Configuration
- [ ] Create new Replit project (Python + Node template)
- [ ] Enable PostgreSQL in Tools
- [ ] Add secrets: `OPENAI_API_KEY`, `RESEND_API_KEY`, `SECRET_KEY`
- [ ] Install Python dependencies: `pip install flask flask-sqlalchemy psycopg2-binary pymupdf openai resend pydantic textstat python-dotenv redis rq apscheduler`
- [ ] Install Node dependencies: `npm install react react-dom react-router-dom @tanstack/react-query zustand tailwindcss`
- [ ] Run database migrations

### Phase 2 Setup

#### Additional Accounts
- [ ] **Pinecone:** Sign up â†’ Create index (1536 dimensions, cosine) â†’ Add `PINECONE_API_KEY`, `PINECONE_INDEX`
- [ ] **Twilio:** Sign up â†’ Get account SID + auth token â†’ Add secrets
- [ ] **Twilio:** Purchase phone number for SMS

#### Knowledge Base
- [ ] Download FDA medication guides for top 100 drugs
- [ ] Run `python knowledge_base/ingest.py` to embed and store

### Phase 3 Setup

#### WhatsApp
- [ ] **Twilio:** Apply for WhatsApp Business API access
- [ ] **Twilio:** Create message templates â†’ Submit for approval
- [ ] Update delivery service with WhatsApp support

---

## 7. Cost Projections

### Phase 1 (Pilot: ~50 patients)
| Service | Usage | Cost |
|---------|-------|------|
| OpenAI GPT-4o | ~200 API calls (extract + simplify + translate Ã— 50) | ~$10-15 |
| Resend | ~150 emails | Free tier |
| Replit | Paid plan | Already included |
| **Total** | | **~$15** |

### Phase 2 (100 patients)
| Service | Usage | Cost |
|---------|-------|------|
| OpenAI | ~500 API calls | ~$30 |
| Pinecone | Free tier | $0 |
| Twilio SMS | 300 messages Ã— $0.0079 | ~$3 |
| Resend | ~200 emails | Free tier |
| **Total** | | **~$35** |

### Phase 3+ (Scale)
| Service | Usage | Cost/Month |
|---------|-------|------------|
| OpenAI | ~5000 calls | ~$300 |
| Pinecone | Starter ($70) or free tier | $0-70 |
| Twilio | ~3000 SMS | ~$25 |
| WhatsApp | ~1000 messages | ~$50 |
| **Total** | | **~$375-450** |

---

# Part IV: Appendices

## Appendix A: Synthetic Test Data Generator

```python
# scripts/generate_synthetic.py
import random
from datetime import datetime, timedelta

DIAGNOSES = [
    "Community-acquired pneumonia",
    "Acute exacerbation of COPD",
    "Congestive heart failure",
    "Acute kidney injury",
    "Cellulitis of lower extremity",
    "Diabetic ketoacidosis",
    "Atrial fibrillation with RVR",
    "Acute pancreatitis",
]

MEDICATIONS = [
    {"name": "Metoprolol (Lopressor)", "doses": ["25mg", "50mg"], "frequencies": ["twice daily", "once daily"]},
    {"name": "Lisinopril (Zestril)", "doses": ["10mg", "20mg"], "frequencies": ["once daily"]},
    {"name": "Furosemide (Lasix)", "doses": ["20mg", "40mg"], "frequencies": ["once daily", "twice daily"]},
    {"name": "Metformin (Glucophage)", "doses": ["500mg", "1000mg"], "frequencies": ["twice daily"]},
    {"name": "Amoxicillin (Amoxil)", "doses": ["500mg", "875mg"], "frequencies": ["twice daily", "three times daily"]},
    {"name": "Prednisone", "doses": ["10mg", "20mg", "40mg"], "frequencies": ["once daily"]},
    {"name": "Warfarin (Coumadin)", "doses": ["2mg", "5mg"], "frequencies": ["once daily at bedtime"]},
    {"name": "Gabapentin (Neurontin)", "doses": ["300mg", "600mg"], "frequencies": ["three times daily"]},
]

def generate_patient():
    first_names = ["Maria", "Jose", "Ana", "Carlos", "Rosa", "Juan", "Carmen", "Luis"]
    languages = ["es", "en", "zh", "vi", "tl"]
    
    return {
        "first_name": random.choice(first_names),
        "dob_year": random.randint(1940, 1990),
        "preferred_language": random.choice(languages),
        "phone": f"+1555{random.randint(1000000, 9999999)}",
        "email": f"patient{random.randint(1000,9999)}@test.litera.ai"
    }

def generate_discharge_summary():
    diagnosis = random.choice(DIAGNOSES)
    meds = random.sample(MEDICATIONS, random.randint(2, 5))
    
    med_list = []
    for med in meds:
        med_list.append({
            "name": med["name"],
            "dose": random.choice(med["doses"]),
            "frequency": random.choice(med["frequencies"]),
            "instructions": random.choice(["Take with food", "Take on empty stomach", ""])
        })
    
    discharge_date = datetime.now() - timedelta(hours=random.randint(1, 4))
    followup_date = discharge_date + timedelta(days=random.randint(5, 14))
    
    return {
        "diagnosis": diagnosis,
        "medications": med_list,
        "appointments": [{
            "date": followup_date.strftime("%Y-%m-%d"),
            "time": f"{random.randint(9, 16)}:00",
            "provider": f"Dr. {random.choice(['Smith', 'Johnson', 'Williams', 'Garcia'])}",
            "location": "123 Medical Center Drive, Suite 200",
            "purpose": "Follow-up visit"
        }],
        "discharge_date": discharge_date.isoformat(),
        "warnings": [
            "Return to ER if you have difficulty breathing",
            "Call your doctor if you develop fever above 101Â°F"
        ]
    }
```

## Appendix B: Sample Prompts

### Extraction Prompt
```
You are a medical document parser for discharge summaries.

Extract the following into JSON:
- diagnosis: Primary diagnosis (string)
- medications: Array of {name, dose, frequency, instructions}
- appointments: Array of {date, time, provider, location, purpose}
- dietary_restrictions: Array of strings
- activity_restrictions: Array of strings
- warning_signs: Array of strings (when to seek emergency care)
- other_instructions: Free text

RULES:
- Extract ONLY what is explicitly stated
- Preserve drug names exactly as written
- Use ISO date format (YYYY-MM-DD)
- If a field is not present, use empty array or null

Return valid JSON only.
```

### Simplification Prompt
```
You are a health literacy expert helping patients understand their care instructions.

Simplify the following medical text to a {grade_level} reading level.

RULES:
1. Use short sentences (max 15 words)
2. Replace medical jargon:
   - "administer" â†’ "take" or "give"
   - "orally" â†’ "by mouth"
   - "BID" â†’ "twice a day"
   - "PRN" â†’ "as needed"
   - "ambulate" â†’ "walk"
3. Keep drug names exactly as written
4. Use active voice ("Take your medicine" not "Medicine should be taken")
5. Include specific times when possible
6. Number steps for multi-step instructions

TEXT TO SIMPLIFY:
{text}

Return only the simplified text.
```

### Translation Prompt
```
Translate the following patient care instructions to {language}.

RULES:
1. Keep drug names in English, with translation in parentheses if helpful
2. Use simple, conversational language
3. Preserve all numbers and times exactly
4. Maintain the same structure and formatting
5. Use formal "you" form appropriate for healthcare

TEXT:
{text}

Return only the translated text.
```

---

## Appendix C: Compliance Checklist

### TCM Billing (CPT 99495/99496)
- [ ] System records discharge timestamp
- [ ] Interactive contact attempted within 2 business days
- [ ] System accounts for weekends/holidays in scheduling
- [ ] Patient response logged with timestamp
- [ ] Two attempts made before flagging for manual follow-up
- [ ] Audit trail exportable for billing coder

### Section 1557 (Language Access)
- [ ] Machine translation not sent directly to patient
- [ ] Clinician review required before delivery
- [ ] Reviewer identity logged (user_id)
- [ ] Review timestamp logged
- [ ] Back-translation available for verification
- [ ] Supported languages cover >5% threshold populations

### HIPAA (Data Security)
- [ ] No real PHI used in Replit prototype
- [ ] Synthetic data clearly marked
- [ ] Environment secrets properly configured
- [ ] Database access restricted
- [ ] Audit log captures all data access

---

*End of Comprehensive PRD*
